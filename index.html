<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Track & Field CRM</title>

<style>
body{
  font-family:system-ui;
  background:#0f172a;
  color:white;
  text-align:center;
}

h1{margin:20px;}

select,button{
  padding:10px;
  margin:6px;
  border:none;
  border-radius:8px;
  font-weight:bold;
}

button{
  background:#22c55e;
  cursor:pointer;
}

button:hover{background:#16a34a;}

table{
  margin:auto;
  border-collapse:collapse;
  width:95%;
  background:#1e293b;
  border-radius:10px;
  overflow:hidden;
}

th,td{
  border:1px solid #334155;
  padding:10px;
}

th{background:#2563eb;}

input{
  width:100%;
  background:#0f172a;
  color:white;
  border:none;
  padding:6px;
  text-align:center;
}

.pr{background:#facc15;color:black;font-weight:bold;}
</style>
</head>

<body>

<h1>ğŸƒ Track & Field CRM</h1>

<div>
<select id="athleteSelect"></select>
<button onclick="newAthlete()">â• New Athlete</button>
<button onclick="deleteAthlete()">ğŸ—‘ï¸ Delete</button>
</div>

<p>
<button onclick="addRow()">â• Add Result</button>
<button onclick="saveAll()">ğŸ’¾ Save</button>
</p>

<table id="crmTable">
<thead>
<tr>
<th>Meet / Date</th>
<th>100m</th>
<th>200m</th>
<th>400m</th>
<th>800m</th>
<th>1600m</th>
<th>Long Jump</th>
<th>High Jump</th>
<th>Triple Jump</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
let db = JSON.parse(localStorage.getItem("trackCRM2")) || {};
let current = null;

function refreshList(){
  const sel = document.getElementById("athleteSelect");
  sel.innerHTML="";
  Object.keys(db).forEach(name=>{
    const o=document.createElement("option");
    o.textContent=name;
    sel.appendChild(o);
  });

  if(!current && sel.options.length){
    current=sel.options[0].text;
  }

  sel.value=current || "";
  loadAthlete();
}

function newAthlete(){
  const name=prompt("Athlete name?");
  if(!name) return;
  db[name]=[];
  current=name;
  refreshList();
  saveAll();
}

function deleteAthlete(){
  if(!current) return;
  if(confirm("Delete athlete?")){
    delete db[current];
    current=null;
    refreshList();
    saveAll();
  }
}

document.getElementById("athleteSelect").onchange=e=>{
  current=e.target.value;
  loadAthlete();
};

function addRow(data={}){
  const row=document.querySelector("#crmTable tbody").insertRow();

  const fields=[
    "meet","100","200","400","800","1600","lj","hj","tj"
  ];

  fields.forEach(f=>{
    const cell=row.insertCell();
    const val=data[f]||"";
    cell.innerHTML=`<input value="${val}" oninput="checkPR()">`;
  });
}

function loadAthlete(){
  const body=document.querySelector("#crmTable tbody");
  body.innerHTML="";
  if(!current) return;

  (db[current]||[]).forEach(addRow);
  checkPR();
}

function saveAll(){
  if(!current) return;

  const rows=document.querySelectorAll("#crmTable tbody tr");
  const data=[];

  rows.forEach(row=>{
    const i=row.querySelectorAll("input");
    data.push({
      meet:i[0].value,
      100:i[1].value,
      200:i[2].value,
      400:i[3].value,
      800:i[4].value,
      1600:i[5].value,
      lj:i[6].value,
      hj:i[7].value,
      tj:i[8].value
    });
  });

  db[current]=data;
  localStorage.setItem("trackCRM2",JSON.stringify(db));
  alert("Saved!");
}

function checkPR(){
  const rows=document.querySelectorAll("#crmTable tbody tr");

  const best={
    1:Infinity,2:Infinity,3:Infinity,4:Infinity,5:Infinity,
    6:0,7:0,8:0
  };

  rows.forEach(r=>{
    const i=r.querySelectorAll("input");

    for(let c=1;c<=5;c++){
      const v=parseFloat(i[c].value);
      if(!isNaN(v) && v<best[c]) best[c]=v;
    }

    for(let c=6;c<=8;c++){
      const v=parseFloat(i[c].value);
      if(!isNaN(v) && v>best[c]) best[c]=v;
    }
  });

  rows.forEach(r=>{
    const i=r.querySelectorAll("input");

    for(let c=1;c<=8;c++){
      i[c].classList.remove("pr");
      const v=parseFloat(i[c].value);
      if(isNaN(v)) continue;

      if(c<=5 && v===best[c]) i[c].classList.add("pr");
      if(c>=6 && v===best[c]) i[c].classList.add("pr");
    }
  });
}

refreshList();
</script>

</body>
</html>
