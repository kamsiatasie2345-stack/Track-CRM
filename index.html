<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Track Player CRM</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0b0b0b;
  color:white;
}

header{
  padding:20px;
  font-size:22px;
}

.container{padding:20px;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:20px;
}

.card{
  background:#141414;
  border-radius:12px;
  padding:30px 10px;
  text-align:center;
  cursor:pointer;
  transition:.2s;
  position:relative;
}

.card:hover{
  transform:scale(1.06);
  background:#1f1f1f;
}

.card button{
  position:absolute;
  top:8px;
  right:8px;
  background:#ef4444;
  border:none;
  padding:4px 8px;
  border-radius:6px;
  color:white;
  cursor:pointer;
}

.addCard{
  border:2px dashed #444;
  background:#111827;
  font-size:28px;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  margin:5px 5px 10px 0;
}

.green{background:#22c55e;}
.blue{background:#3b82f6;}
.red{background:#ef4444;}

table{
  width:100%;
  border-collapse:collapse;
  background:#141414;
  margin-top:10px;
}

th,td{
  border:1px solid #2a2a2a;
  padding:10px;
  text-align:center;
}

th{background:#2563eb;}

input{
  width:100%;
  background:transparent;
  border:none;
  color:white;
  text-align:center;
}

.pr{
  background:#facc15;
  color:black;
  font-weight:bold;
}

.panel{
  background:#141414;
  padding:15px;
  margin-top:15px;
  border-radius:10px;
}
</style>
</head>

<body>

<header>üèÉ Player Performance Tracker</header>

<div id="home" class="container"></div>
<div id="profile" class="container" style="display:none;"></div>

<script>
let db = JSON.parse(localStorage.getItem("soloPlayersCRM")) || {};
let current=null;

function save(){
  localStorage.setItem("soloPlayersCRM", JSON.stringify(db));
}

/* ---------- HOME SCREEN ---------- */

function showHome(){
  document.getElementById("profile").style.display="none";
  const home=document.getElementById("home");
  home.style.display="block";

  let html='<div class="grid">';

  Object.keys(db).forEach(name=>{
    html+=`
      <div class="card" onclick="openPlayer('${name}')">
        ${name}
        <button onclick="event.stopPropagation();deletePlayer('${name}')">‚úñ</button>
      </div>
    `;
  });

  html+=`
    <div class="card addCard" onclick="newPlayer()">‚ûï</div>
  </div>`;

  home.innerHTML=html;
}

function newPlayer(){
  const name=prompt("Player name?");
  if(!name) return;
  db[name]=[];
  save();
  showHome();
}

function deletePlayer(name){
  if(confirm("Delete "+name+"?")){
    delete db[name];
    save();
    showHome();
  }
}

/* ---------- PROFILE ---------- */

function openPlayer(name){
  current=name;
  document.getElementById("home").style.display="none";
  const p=document.getElementById("profile");
  p.style.display="block";

  let html=`
    <button class="blue" onclick="showHome()">‚Üê Back</button>
    <h2>${name}</h2>

    <button class="green" onclick="addRow()">‚ûï Add Result</button>
    <button class="red" onclick="clearAll()">üóë Clear All</button>
    <button class="blue" onclick="saveProfile()">üíæ Save</button>

    <table id="tbl">
      <tr>
        <th>Meet</th>
        <th>100</th><th>200</th><th>400</th>
        <th>800</th><th>1600</th>
        <th>LJ</th><th>HJ</th><th>TJ</th>
        <th>‚ùå</th>
      </tr>
    </table>

    <div id="bests" class="panel"></div>
  `;

  p.innerHTML=html;

  db[name].forEach(addRow);
  updatePR();
}

function addRow(data={}){
  const tbl=document.getElementById("tbl");
  const r=tbl.insertRow();

  const fields=["meet","100","200","400","800","1600","lj","hj","tj"];

  fields.forEach(f=>{
    const c=r.insertCell();
    c.innerHTML=`<input value="${data[f]||""}" oninput="updatePR()">`;
  });

  const del=r.insertCell();
  del.innerHTML=`<button class="red" onclick="this.closest('tr').remove();updatePR()">X</button>`;
}

function saveProfile(){
  const rows=document.querySelectorAll("#tbl tr");
  const data=[];

  rows.forEach((r,i)=>{
    if(i===0) return;
    const x=r.querySelectorAll("input");
    data.push({
      meet:x[0].value,
      100:x[1].value,
      200:x[2].value,
      400:x[3].value,
      800:x[4].value,
      1600:x[5].value,
      lj:x[6].value,
      hj:x[7].value,
      tj:x[8].value
    });
  });

  db[current]=data;
  save();
  alert("Saved!");
}

function clearAll(){
  if(confirm("Clear all results?")){
    db[current]=[];
    save();
    openPlayer(current);
  }
}

/* ---------- PR SYSTEM ---------- */

function updatePR(){
  const rows=document.querySelectorAll("#tbl tr");
  const best={1:Infinity,2:Infinity,3:Infinity,4:Infinity,5:Infinity,6:0,7:0,8:0};

  rows.forEach((r,i)=>{
    if(i===0) return;
    const x=r.querySelectorAll("input");

    for(let c=1;c<=5;c++){
      const v=parseFloat(x[c].value);
      if(!isNaN(v)&&v<best[c]) best[c]=v;
    }

    for(let c=6;c<=8;c++){
      const v=parseFloat(x[c].value);
      if(!isNaN(v)&&v>best[c]) best[c]=v;
    }
  });

  rows.forEach((r,i)=>{
    if(i===0) return;
    const x=r.querySelectorAll("input");

    for(let c=1;c<=8;c++){
      x[c].classList.remove("pr");
      const v=parseFloat(x[c].value);
      if(isNaN(v)) continue;

      if((c<=5 && v===best[c]) || (c>=6 && v===best[c]))
        x[c].classList.add("pr");
    }
  });

  document.getElementById("bests").innerHTML=`
    <h3>ü•á Personal Bests</h3>
    100: ${best[1]||"-"} | 200: ${best[2]||"-"} | 400: ${best[3]||"-"}<br>
    800: ${best[4]||"-"} | 1600: ${best[5]||"-"}<br>
    LJ: ${best[6]||"-"} | HJ: ${best[7]||"-"} | TJ: ${best[8]||"-"}
  `;
}

showHome();
</script>

</body>
</html>
